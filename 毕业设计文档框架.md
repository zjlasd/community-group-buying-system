# 毕业设计文档框架

## 一、项目概述

### 1.1 项目背景
#### 1.1.1 研究背景
社区团购模式（如美团优选、多多买菜）已成为连接本地供给与社区需求的重要商业模式。在这种模式中，团长作为供应链末端的核心节点，承担着订单收集、商品配送、用户维护等关键职责，其管理效率直接影响整个供应链的运营质量。

#### 1.1.2 问题陈述
当前许多中小型社区团购平台在运营过程中面临以下痛点：
- **佣金核算效率低**：团长佣金计算依赖人工统计，耗时且易出错
- **订单汇总困难**：多个社区、多个团长的订单汇总缺乏自动化工具
- **配送清单生成繁琐**：次日配送清单需要人工整理，效率低下
- **数据可视化缺失**：缺乏直观的数据看板，管理决策缺乏数据支撑
- **权限管理混乱**：不同角色的权限划分不清晰

#### 1.1.3 研究意义
- **提升管理效率**：通过系统自动化减少人工操作，降低运营成本
- **减少人为失误**：自动化计算和汇总减少数据错误
- **优化决策支持**：可视化数据看板为管理层提供决策依据
- **提升用户体验**：团长可以更便捷地管理订单和查看收益

#### 1.1.4 项目目标
开发一个操作便捷、可视化程度高的社区团购管理系统，实现：
- 团长佣金自动核算与可视化展示
- 订单自动汇总与智能筛选
- 配送清单一键生成与导出
- 多角色权限管理
- 提升供应链末端的数字化管理水平

### 1.2 项目简介
- **项目名称**：社区团购团长分销与订单汇总系统
- **项目定位**：面向中小型社区团购平台的末端供应链管理系统
- **核心功能概述**：
  - 团长个人中心（佣金看板、订单管理、提现申请）
  - 后台管理系统（订单汇总、配送清单导出、团长管理）
  - 多角色权限控制（超级管理员、普通管理员、团长）
- **预期成果**：
  - 完整的前后端分离Web应用系统
  - 可视化数据看板与报表导出功能
  - 完善的技术文档与使用手册
  - 可部署的生产环境应用

### 1.3 业务运营流程说明
为了更好地理解系统设计的业务背景，本节详细阐述社区团购的实际运营模式和各角色职责。

#### 1.3.1 角色定位与职责
社区团购业务涉及四个核心角色，各司其职：

**1. 平台方（本系统服务对象）**
- 提供商品货源与价格管理
- 负责订单数据的汇总与统计
- 管理团长账户与佣金结算
- 协调供应商配送资源

**2. 团长（核心节点）**
- **定位**：社区的"销售代理人"和"自提点负责人"
- **核心职责**：
  - 社区推广：在微信群/朋友圈分享商品链接
  - 自提点管理：提供固定地点（自家/店铺）供邻居取货
  - 客户服务：解答咨询、处理售后问题
  - 订单核销：确认消费者取货完成
- **收入来源**：按订单金额抽取佣金（通常10%-15%）
- **重要说明**：团长**不负责配送**，仅提供自提点

**3. 供应商/平台仓库**
- 负责商品仓储与质量管控
- 根据配送清单统一配送到各团长处
- 物流成本由平台承担

**4. 消费者（终端用户）**
- 在移动端（小程序/H5）浏览商品并下单
- 到团长处自提商品
- 本系统不直接服务该角色（由独立的C端系统实现）

#### 1.3.2 完整业务流程（7天周期）

```
【第1-3天：预售期（周一-周三）】
├─ 09:00  团长在社区微信群发送商品链接
│          示例："明天苹果特价4.5元/斤，点击下单👇"
├─ 用户行为：
│   ├─ 消费者在小程序下单
│   ├─ 选择所属团长（系统自动关联或用户选择）
│   └─ 支付成功，订单状态：待成团
└─ 系统记录：订单自动归类到对应团长名下

【第4天：截单日（周四）】
├─ 00:00  系统定时任务自动执行：
│   ├─ 检查截单时间，批量更新订单状态：待成团 → 已成团
│   ├─ 按团长维度汇总订单数据
│   └─ 生成《配送清单》
├─ 配送清单示例：
│   ┌─────────────────────────────┐
│   │ 张阿姨（阳光小区）配送清单  │
│   ├─────────┬──────┬──────────┤
│   │ 商品名称 │ 数量 │ 来源订单数 │
│   ├─────────┼──────┼──────────┤
│   │ 新鲜苹果 │ 200斤│ 50单      │
│   │ 有机牛奶 │ 30箱 │ 30单      │
│   │ 土鸡蛋   │ 80盒 │ 40单      │
│   └─────────┴──────┴──────────┘
├─ 10:00  团长登录系统查看/打印配送清单
└─ 订单状态：已成团 → 待配送

【第5天：配送日（周五）】
├─ 08:00  供应商根据清单配送到各团长处
├─ 10:00  张阿姨收到货物：
│   ├─ 核对清单数量
│   ├─ 发现问题：苹果少了10斤
│   ├─ 在系统标记异常，联系平台
│   └─ 确认无误后点击"确认收货"
├─ 系统操作：
│   ├─ 订单状态：待配送 → 待自提
│   └─ 自动发送短信/公众号通知消费者取货
└─ 团长准备：整理货物，准备核销工具（手机/扫码枪）

【第6-7天：自提期（周六-周日）】
├─ 消费者陆续到团长处取货：
│   ├─ 李大爷："我买了5斤苹果"
│   ├─ 张阿姨扫描李大爷的订单二维码
│   ├─ 系统显示：✓ 订单#12345已核销
│   └─ 李大爷带走苹果
├─ 系统自动计算：
│   ├─ 订单金额：22.5元
│   ├─ 团长佣金率：12%
│   ├─ 佣金金额：2.7元
│   └─ 佣金记录写入数据库
├─ 订单状态：待自提 → 已完成
└─ 逾期处理：3天未自提 → 订单状态：已过期

【月底：结算期】
├─ 团长查看本月业绩：
│   ├─ 总订单数：200单
│   ├─ 总销售额：5000元
│   ├─ 累计佣金：600元
│   └─ 可提现金额：600元（扣除已提现）
├─ 团长发起提现申请
├─ 管理员审核通过
└─ 平台打款到团长账户（1-3个工作日）
```

#### 1.3.3 系统核心价值
本系统通过自动化流程解决传统模式的三大痛点：

**痛点1：手工统计耗时费力**
- ❌ **传统方式**：团长在Excel手工统计"今天需要多少苹果、多少牛奝"
  - 统计时间：2-3小时
  - 错误率：约15%（漏单、重复统计）
- ✅ **系统方案**：一键生成配送清单，自动汇总商品数量
  - 生成时间：<5秒
  - 准确率：100%（自动化计算）

**痛点2：佣金计算混乱易错**
- ❌ **传统方式**：月底手工计算每笔订单佣金
  - 计算周期：1-2天
  - 纠纷率：高（团长质疑计算错误）
- ✅ **系统方案**：订单完成即时计算佣金，实时查看收入
  - 透明度：团长可查看每笔佣金明细
  - 信任度：减少平台与团长纠纷

**痛点3：订单核销效率低**
- ❌ **传统方式**：消费者口述"我是谁谁谁"，团长翻记录确认
  - 核销时长：每单约2-3分钟
  - 错发率：约5%（记忆混淆）
- ✅ **系统方案**：扫码核销，秒级确认
  - 核销时长：每单<10秒
  - 错发率：接近0%

#### 1.3.4 系统边界说明
**本项目实现范围**：
- ✅ **管理后台系统**（B端）
  - 平台管理员：订单管理、团长管理、数据统计
  - 团长：个人中心、业绩查看、提现申请
  - 技术栈：Vue 3 + Node.js + MySQL

**不在实现范围内**：
- ⏸️ **消费者下单系统**（C端）
  - 说明：实际场景中由独立的小程序/H5项目提供
  - 替代方案：本项目提供数据初始化脚本生成模拟订单数据
  - 理由：聚焦管理端核心业务逻辑，避免项目范围过大

#### 1.3.5 实际案例说明
以张阿姨作为阳光小区团长为例：

**周一早上**：张阿姨在小区微信群（300人）发送商品链接
```
【今日特惠】新鲜苹果4.5元/斤🍎
原价6元，限时3天！
点击下单👉 [小程序卡片]
明天截单，后天送到我家取货~
```

**周一-周三**：陆续收到50个订单
- 系统自动记录：所属团长 = 张阿姨（ID: 1）
- 张阿姨随时可登录系统查看订单数

**周四上午**：张阿姨登录系统查看配送清单
```
我的配送清单（2026-02-28）
- 苹果：200斤（50单）
- 香蕉：100斤（30单）
- 牛奶：50箱（25单）
[导出Excel] [打印]
```

**周五早上**：供应商送货上门
- 核对清单：✓ 数量正确
- 点击"确认收货"
- 系统自动通知50位消费者："您的订单已到达张阿姨处，周末可取货"

**周六-周日**：邻居们陆续取货
- 李大爷出示订单二维码
- 张阿姨手机扫码 → 系统显示：✓ 李大爷，5斤苹果
- 确认核销 → 佣金2.7元自动入账

**月底**：张阿姨查看收入
- 本月促成200单
- 总销售额：5000元
- 累计佣金：600元
- 点击"申请提现" → 等待平台审核 → 1-3天到账

---

## 二、需求分析

### 2.1 市场调研
#### 2.1.1 竞品分析
- **多多买菜**
  - 团区分配功能实现方式
  - 用户交互流程
  - 功能特点总结
  - 优势与不足

- **美团**
  - 团区分配功能实现方式
  - 用户交互流程
  - 功能特点总结
  - 优势与不足

#### 2.1.2 调研结论
- 行业通用实现方案
- 可借鉴的设计模式
- 创新点与差异化方向

### 2.2 功能需求
#### 2.2.1 核心功能清单
- **功能点1：团长个人中心**
  - 可视化佣金看板（收益统计、趋势图表）
  - 个人订单管理（查看、筛选、详情）
  - 提现申请流程（申请、审核、记录查询）
  
- **功能点2：订单管理系统**
  - 订单汇总视图（按社区/团长自动聚合）
  - 多维度筛选（时间、状态、团长、社区）
  - 订单排序与搜索功能
  - 订单详情查看与编辑
  
- **功能点3：配送清单生成**
  - 一键生成次日配送清单
  - Excel/PDF格式导出
  - 按社区/团长分组导出
  - 自定义导出字段
  
- **功能点4：团长管理**
  - 团长信息增删改查
  - 团长绑定社区/区域
  - 团长业绩统计与排名
  - 团长权限管理
  
- **功能点5：数据可视化**
  - 订单量趋势分析
  - 销售额统计图表
  - 团长业绩对比
  - 商品销售排行
  
- **功能点6：权限控制**
  - 前端路由级权限管理
  - 三级角色划分（超级管理员、普通管理员、团长）
  - 接口级权限验证
  - 操作日志记录

#### 2.2.2 功能详细说明

**团长个人中心**
- **用户场景**：团长登录系统后查看自己的收益、管理订单、申请提现
- **功能流程**：
  1. 团长登录 → 进入个人中心
  2. 查看佣金看板（今日/本周/本月收益）
  3. 浏览订单列表，可按状态筛选
  4. 发起提现申请，填写提现金额和账户信息
  5. 查看提现记录和审核状态

**订单汇总管理**
- **用户场景**：管理员需要查看所有订单，按团长或社区进行汇总统计
- **功能流程**：
  1. 管理员登录 → 进入订单管理
  2. 选择时间范围和筛选条件
  3. 系统自动聚合订单数据
  4. 查看汇总数据和明细列表
  5. 导出报表或配送清单

**配送清单生成**
- **用户场景**：每日下班前生成次日配送清单，分发给各团长
- **功能流程**：
  1. 选择日期和社区范围
  2. 点击"生成配送清单"
  3. 系统自动汇总商品数量
  4. 按团长分组生成清单
  5. 一键导出Excel/PDF文件

### 2.3 非功能需求
#### 2.3.1 性能要求
- 页面首屏加载时间 < 2秒
- 订单列表支持分页，单页响应时间 < 500ms
- 导出1000条订单数据耗时 < 3秒
- 系统支持100+并发用户同时在线

#### 2.3.2 安全性要求
- 用户密码采用bcrypt加密存储
- 使用JWT进行身份认证
- 接口级权限验证，防止越权访问
- 敏感操作（提现、删除）需要二次确认
- SQL注入、XSS攻击防护

#### 2.3.3 可用性要求
- 界面简洁友好，符合用户使用习惯
- 关键操作提供明确的反馈提示
- 表单验证及时，错误提示清晰
- 支持快捷键操作（如Enter提交）
- 移动端适配，支持响应式布局

#### 2.3.4 兼容性要求
- 浏览器兼容：Chrome 90+、Firefox 88+、Safari 14+、Edge 90+
- 屏幕分辨率：支持1366x768及以上
- 移动端适配：支持iOS 12+、Android 8+
- 数据格式：支持导出Excel（.xlsx）和PDF格式

---

## 三、技术方案

### 3.1 技术栈规划
#### 3.1.1 前端技术栈
- **框架选型**：Vue.js 3.x
- **构建工具**：Vite 4.x
- **UI组件库**：Element Plus
- **状态管理**：Pinia
- **路由管理**：Vue Router 4.x
- **HTTP请求**：Axios
- **数据可视化**：ECharts 5.x
- **表格导出**：xlsx / js-export-excel
- **代码规范**：ESLint + Prettier
- **其他工具库**：
  - dayjs（时间处理）
  - lodash（工具函数）
  - nprogress（加载进度条）

#### 3.1.2 后端技术栈
- **编程语言**：Node.js 16.x+
- **框架**：Express.js 4.x
- **数据库**：MySQL 8.0
- **ORM框架**：Sequelize
- **身份认证**：JWT (jsonwebtoken)
- **密码加密**：bcrypt
- **参数验证**：joi / express-validator
- **日志管理**：winston / morgan
- **Excel处理**：xlsx / exceljs
- **PDF生成**：pdfkit / puppeteer
- **API文档**：Swagger / Apifox

#### 3.1.3 技术栈选型理由

**前端 - Vue.js 3 + Vite + Element Plus**
- **Vue.js 3**：
  - Composition API提供更好的代码组织和逻辑复用
  - 性能优化，虚拟DOM重写，渲染速度提升
  - TypeScript支持更好
  - 生态成熟，社区活跃
  
- **Vite**：
  - 开发环境冷启动速度快
  - HMR（热模块替换）响应迅速
  - 生产环境打包优化
  
- **Element Plus**：
  - 组件丰富，满足后台管理系统需求
  - 文档完善，上手快
  - 与Vue 3完美适配
  - 支持主题定制

- **ECharts**：
  - 数据可视化功能强大
  - 图表类型丰富
  - 交互性好，配置灵活

**后端 - Node.js + Express + MySQL**
- **Node.js + Express**：
  - JavaScript全栈开发，降低学习成本
  - 异步I/O模型，适合高并发场景
  - Express轻量灵活，中间件生态丰富
  - 开发效率高
  
- **MySQL**：
  - 关系型数据库，适合结构化数据
  - ACID特性保证数据一致性
  - 事务支持，适合订单、佣金等关键业务
  - 成熟稳定，社区资源丰富
  
- **Sequelize ORM**：
  - 简化数据库操作
  - 支持迁移和模型定义
  - 防止SQL注入

**其他工具库选型**
- **JWT**：无状态认证，适合前后端分离架构
- **bcrypt**：单向加密，安全性高
- **xlsx**：Excel读写功能完善，性能好
- **Pinia**：Vue 3官方推荐的状态管理工具，API简洁

### 3.2 系统架构设计
#### 3.2.1 整体架构
**架构模式**：前后端分离 + RESTful API

```
┌─────────────────────────────────────────────────┐
│                  客户端层 (Browser)              │
│            Vue 3 + Element Plus + ECharts       │
└─────────────────┬───────────────────────────────┘
                  │ HTTP/HTTPS (Axios)
                  │ RESTful API
┌─────────────────▼───────────────────────────────┐
│                  应用服务层                       │
│              Node.js + Express.js                │
│  ┌──────────┬──────────┬──────────┬──────────┐  │
│  │ 认证中间件│路由层    │业务逻辑层 │工具层    │  │
│  │  JWT     │ Router   │ Service  │ Utils    │  │
│  └──────────┴──────────┴──────────┴──────────┘  │
└─────────────────┬───────────────────────────────┘
                  │ Sequelize ORM
┌─────────────────▼───────────────────────────────┐
│                  数据持久层                       │
│                  MySQL 8.0                       │
│  ┌──────────┬──────────┬──────────┬──────────┐  │
│  │ 用户表   │订单表    │团长表    │佣金表    │  │
│  └──────────┴──────────┴──────────┴──────────┘  │
└─────────────────────────────────────────────────┘
```

**模块划分**：
- **用户认证模块**：登录、注册、权限验证
- **订单管理模块**：订单CRUD、汇总、筛选
- **团长管理模块**：团长信息管理、业绩统计
- **佣金管理模块**：佣金计算、提现申请、审核
- **报表导出模块**：配送清单生成、Excel/PDF导出
- **数据统计模块**：数据可视化、图表生成

**数据流向**：
1. 用户在前端操作 → 触发事件
2. 前端发送HTTP请求 → 后端API
3. 后端验证权限 → 处理业务逻辑
4. 操作数据库 → 返回结果
5. 前端接收数据 → 更新视图

#### 3.2.2 前端架构设计

**目录结构规划**：
```
community-group-buying-admin/
├── public/                 # 静态资源
│   └── favicon.ico
├── src/
│   ├── api/               # API接口封装
│   │   ├── index.js       # axios配置
│   │   ├── user.js        # 用户相关接口
│   │   ├── order.js       # 订单相关接口
│   │   ├── leader.js      # 团长相关接口
│   │   └── commission.js  # 佣金相关接口
│   ├── assets/            # 资源文件
│   │   ├── images/
│   │   └── styles/
│   │       └── global.scss
│   ├── components/        # 公共组件
│   │   ├── Layout/        # 布局组件
│   │   ├── Charts/        # 图表组件
│   │   ├── Upload/        # 上传组件
│   │   └── Table/         # 表格组件
│   ├── views/             # 页面组件
│   │   ├── Login/         # 登录页
│   │   ├── Dashboard/     # 数据看板
│   │   ├── Order/         # 订单管理
│   │   ├── Leader/        # 团长管理
│   │   ├── Commission/    # 佣金管理
│   │   └── Profile/       # 个人中心
│   ├── router/            # 路由配置
│   │   ├── index.js       # 路由入口
│   │   └── permission.js  # 权限守卫
│   ├── store/             # 状态管理 (Pinia)
│   │   ├── modules/
│   │   │   ├── user.js    # 用户状态
│   │   │   ├── order.js   # 订单状态
│   │   │   └── app.js     # 应用状态
│   │   └── index.js
│   ├── utils/             # 工具函数
│   │   ├── auth.js        # 认证工具
│   │   ├── request.js     # 请求封装
│   │   ├── validate.js    # 表单验证
│   │   ├── export.js      # 导出工具
│   │   └── format.js      # 格式化工具
│   ├── directives/        # 自定义指令
│   ├── mixins/            # 混入
│   ├── App.vue            # 根组件
│   └── main.js            # 入口文件
├── .env.development       # 开发环境变量
├── .env.production        # 生产环境变量
├── vite.config.js         # Vite配置
├── package.json
└── README.md
```

**组件层级设计**：
```
App.vue
└── Layout (布局组件)
    ├── Header (顶部导航)
    ├── Sidebar (侧边栏菜单)
    └── Main (主内容区)
        ├── Dashboard (数据看板)
        │   ├── StatCard (统计卡片)
        │   ├── LineChart (折线图)
        │   └── BarChart (柱状图)
        ├── OrderList (订单列表)
        │   ├── SearchForm (搜索表单)
        │   ├── DataTable (数据表格)
        │   └── Pagination (分页)
        └── LeaderManage (团长管理)
            ├── LeaderForm (表单)
            └── LeaderTable (表格)
```

**路由设计**：
```javascript
// 路由配置示例
{
  path: '/',
  redirect: '/dashboard',
  component: Layout,
  children: [
    {
      path: 'dashboard',
      name: 'Dashboard',
      component: () => import('@/views/Dashboard'),
      meta: { title: '数据看板', roles: ['admin', 'manager', 'leader'] }
    },
    {
      path: 'order',
      name: 'Order',
      component: () => import('@/views/Order'),
      meta: { title: '订单管理', roles: ['admin', 'manager'] }
    },
    {
      path: 'leader',
      name: 'Leader',
      component: () => import('@/views/Leader'),
      meta: { title: '团长管理', roles: ['admin', 'manager'] }
    },
    {
      path: 'commission',
      name: 'Commission',
      component: () => import('@/views/Commission'),
      meta: { title: '佣金管理', roles: ['admin', 'leader'] }
    }
  ]
}
```

**状态管理方案 (Pinia)**：
- **user模块**：用户信息、token、角色权限
- **order模块**：订单列表、筛选条件、统计数据
- **app模块**：侧边栏状态、主题配置、语言设置

**代码组织规范**：
- 组件命名采用PascalCase（大驼峰）
- 文件夹命名采用kebab-case（短横线）
- API接口按模块分类封装
- 工具函数独立封装，便于复用
- 使用ESLint + Prettier统一代码风格

#### 3.2.3 数据库设计

**ER图**（实体关系图）：
```
┌─────────────┐         ┌─────────────┐         ┌─────────────┐
│    User     │         │   Leader    │         │  Community  │
│  (用户表)   │────────│  (团长表)   │────────│  (社区表)   │
└─────────────┘  1:1    └─────────────┘  1:N    └─────────────┘
                                │
                                │ 1:N
                                │
┌─────────────┐         ┌─────────────┐         ┌─────────────┐
│   Product   │         │    Order    │         │ Commission  │
│  (商品表)   │────────│  (订单表)   │────────│  (佣金表)   │
└─────────────┘  N:M    └─────────────┘  1:N    └─────────────┘
                                │
                                │ 1:N
                                │
                        ┌─────────────┐
                        │ OrderItem   │
                        │(订单明细表) │
                        └─────────────┘
```

**数据表设计**：

**1. 用户表 (users)**
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INT | 用户ID | 主键、自增 |
| username | VARCHAR(50) | 用户名 | 唯一、非空 |
| password | VARCHAR(255) | 密码（加密） | 非空 |
| real_name | VARCHAR(50) | 真实姓名 | - |
| phone | VARCHAR(20) | 手机号 | 唯一 |
| role | ENUM | 角色（admin/manager/leader） | 非空 |
| status | TINYINT | 状态（0禁用/1启用） | 默认1 |
| created_at | DATETIME | 创建时间 | 非空 |
| updated_at | DATETIME | 更新时间 | 非空 |

**2. 团长表 (leaders)**
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INT | 团长ID | 主键、自增 |
| user_id | INT | 关联用户ID | 外键、唯一 |
| community_id | INT | 所属社区ID | 外键 |
| commission_rate | DECIMAL(5,2) | 佣金比例（%） | 非空 |
| total_orders | INT | 累计订单数 | 默认0 |
| total_commission | DECIMAL(10,2) | 累计佣金 | 默认0.00 |
| balance | DECIMAL(10,2) | 账户余额 | 默认0.00 |
| status | TINYINT | 状态（0禁用/1启用） | 默认1 |
| created_at | DATETIME | 创建时间 | 非空 |
| updated_at | DATETIME | 更新时间 | 非空 |

**3. 社区表 (communities)**
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INT | 社区ID | 主键、自增 |
| name | VARCHAR(100) | 社区名称 | 非空 |
| address | VARCHAR(255) | 详细地址 | - |
| contact | VARCHAR(50) | 联系人 | - |
| phone | VARCHAR(20) | 联系电话 | - |
| status | TINYINT | 状态（0禁用/1启用） | 默认1 |
| created_at | DATETIME | 创建时间 | 非空 |
| updated_at | DATETIME | 更新时间 | 非空 |

**4. 订单表 (orders)**
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INT | 订单ID | 主键、自增 |
| order_no | VARCHAR(32) | 订单号 | 唯一、非空 |
| leader_id | INT | 团长ID | 外键、非空 |
| community_id | INT | 社区ID | 外键、非空 |
| user_name | VARCHAR(50) | 下单用户姓名 | - |
| user_phone | VARCHAR(20) | 用户手机号 | - |
| total_amount | DECIMAL(10,2) | 订单总金额 | 非空 |
| commission_amount | DECIMAL(10,2) | 佣金金额 | 默认0.00 |
| status | TINYINT | 订单状态（0待确认/1已确认/2配送中/3已完成/4已取消） | 默认0 |
| order_date | DATE | 下单日期 | 非空 |
| delivery_date | DATE | 配送日期 | - |
| remark | TEXT | 备注 | - |
| created_at | DATETIME | 创建时间 | 非空 |
| updated_at | DATETIME | 更新时间 | 非空 |

**5. 订单明细表 (order_items)**
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INT | 明细ID | 主键、自增 |
| order_id | INT | 订单ID | 外键、非空 |
| product_id | INT | 商品ID | 外键、非空 |
| product_name | VARCHAR(100) | 商品名称 | 非空 |
| price | DECIMAL(10,2) | 单价 | 非空 |
| quantity | INT | 数量 | 非空 |
| subtotal | DECIMAL(10,2) | 小计 | 非空 |
| created_at | DATETIME | 创建时间 | 非空 |

**6. 商品表 (products)**
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INT | 商品ID | 主键、自增 |
| name | VARCHAR(100) | 商品名称 | 非空 |
| category | VARCHAR(50) | 商品分类 | - |
| price | DECIMAL(10,2) | 价格 | 非空 |
| unit | VARCHAR(20) | 单位 | - |
| stock | INT | 库存 | 默认0 |
| image | VARCHAR(255) | 商品图片 | - |
| status | TINYINT | 状态（0下架/1上架） | 默认1 |
| created_at | DATETIME | 创建时间 | 非空 |
| updated_at | DATETIME | 更新时间 | 非空 |

**7. 佣金记录表 (commissions)**
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INT | 记录ID | 主键、自增 |
| leader_id | INT | 团长ID | 外键、非空 |
| order_id | INT | 订单ID | 外键 |
| amount | DECIMAL(10,2) | 佣金金额 | 非空 |
| type | TINYINT | 类型（1收入/2提现） | 非空 |
| status | TINYINT | 状态（0待审核/1已通过/2已拒绝） | 默认0 |
| remark | TEXT | 备注 | - |
| created_at | DATETIME | 创建时间 | 非空 |
| updated_at | DATETIME | 更新时间 | 非空 |

**8. 提现申请表 (withdrawals)**
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INT | 申请ID | 主键、自增 |
| leader_id | INT | 团长ID | 外键、非空 |
| amount | DECIMAL(10,2) | 提现金额 | 非空 |
| account_name | VARCHAR(50) | 账户名 | 非空 |
| account_number | VARCHAR(50) | 账号 | 非空 |
| status | TINYINT | 状态（0待审核/1已通过/2已拒绝） | 默认0 |
| reject_reason | VARCHAR(255) | 拒绝原因 | - |
|审核人_id | INT | 审核人ID | 外键 |
|审核时间 | DATETIME | 审核时间 | - |
| created_at | DATETIME | 创建时间 | 非空 |
| updated_at | DATETIME | 更新时间 | 非空 |

---

## 四、UI/UX设计

### 4.1 设计规范
#### 4.1.1 颜色规范
**主色调**：
- 主色（Primary）：#409EFF - 用于主要按钮、链接
- 成功（Success）：#67C23A - 用于成功提示、状态
- 警告（Warning）：#E6A23C - 用于警告提示
- 危险（Danger）：#F56C6C - 用于删除、危险操作
- 信息（Info）：#909399 - 用于次要信息

**辅助色**：
- 文字主色：#303133
- 文字次色：#606266
- 文字辅助：#909399
- 边框颜色：#DCDFE6
- 背景色：#F5F7FA

#### 4.1.2 字体规范
- **标题字体**：PingFang SC, Microsoft YaHei
- **正文字体**：-apple-system, BlinkMacSystemFont, "Segoe UI"
- **字号规范**：
  - 特大标题：24px
  - 页面标题：20px
  - 卡片标题：16px
  - 正文内容：14px
  - 辅助信息：12px

#### 4.1.3 间距规范
- 页面边距：20px
- 卡片间距：16px
- 表单项间距：20px
- 按钮间距：12px
- 内容内边距：16px

#### 4.1.4 组件规范
- 按钮高度：32px（中等）/ 40px（大）
- 输入框高度：32px
- 表格行高：48px
- 卡片圆角：4px
- 弹窗最小宽度：520px

### 4.2 交互设计
#### 4.2.1 用户流程图

**管理员操作流程**：
```
登录 → 数据看板 → 查看统计数据
                ↓
         订单管理 → 筛选订单 → 查看详情
                ↓
         生成配送清单 → 选择日期和社区 → 导出Excel
                ↓
         团长管理 → 新增/编辑团长 → 绑定社区
                ↓
         佣金审核 → 查看提现申请 → 审核通过/拒绝
```

**团长操作流程**：
```
登录 → 个人中心 → 查看佣金看板
                ↓
         我的订单 → 筛选订单 → 查看订单详情
                ↓
         申请提现 → 填写提现信息 → 提交申请
                ↓
         提现记录 → 查看审核状态
```

#### 4.2.2 交互原型
**登录页面**：
- 居中布局，左侧展示系统介绍，右侧登录表单
- 表单实时验证，错误提示
- 记住密码功能

**数据看板**：
- 顶部展示关键指标卡片（今日订单、今日销售额、待审核提现）
- 中间展示订单趋势折线图
- 底部展示团长业绩排行榜

**订单管理页面**：
- 顶部搜索栏（时间、状态、团长、关键词）
- 操作按钮区（导出配送清单、导出Excel）
- 订单列表表格（支持排序、分页）
- 订单详情抽屉（侧边滑出）

#### 4.2.3 关键页面交互说明

**订单汇总交互**：
1. 用户选择筛选条件（时间范围、团长、社区）
2. 点击"查询"按钮，表格加载loading状态
3. 展示汇总数据和订单列表
4. 点击"导出配送清单"，弹出确认对话框
5. 确认后显示导出进度，完成后自动下载

**提现申请交互**：
1. 团长点击"申请提现"按钮
2. 弹出提现表单对话框
3. 填写提现金额（实时验证余额是否足够）
4. 填写账户信息（银行卡号、姓名）
5. 点击"提交"，显示确认对话框
6. 提交成功，提示"提交成功，等待审核"

### 4.3 界面设计
#### 4.3.1 登录页
- 简洁大方，左右分栏布局
- 左侧：系统Logo、标语、特色功能介绍
- 右侧：登录表单（用户名、密码、验证码）

#### 4.3.2 数据看板页
**布局结构**：
- 顶部：4个统计卡片（今日订单数、今日销售额、待审核提现、活跃团长数）
- 中部左：订单趋势图（折线图，可切换时间维度）
- 中部右：销售额统计（柱状图）
- 底部：团长业绩排行榜（表格）

#### 4.3.3 订单管理页
**页面元素**：
- 搜索区：日期选择器、状态下拉、团长选择、关键词搜索
- 操作区：导出配送清单、导出Excel、刷新
- 表格区：订单号、团长、社区、金额、状态、操作
- 分页区：每页条数、页码跳转

#### 4.3.4 团长管理页
**功能模块**：
- 团长列表（卡片或表格形式）
- 新增团长按钮（右上角）
- 团长信息：姓名、电话、社区、佣金比例、累计订单、累计佣金
- 操作：编辑、禁用/启用、查看详情

#### 4.3.5 个人中心页（团长视图）
**页面布局**：
- 左侧：佣金看板（本月收益、累计收益、可提现余额）
- 中间：收益趋势图
- 右侧：快捷操作（申请提现、查看订单）
- 底部：我的订单列表

### 4.4 响应式设计方案
#### 4.4.1 多端适配策略
- **桌面端（>1200px）**：完整功能，三栏布局
- **平板端（768px-1200px）**：部分功能收缩，双栏布局
- **移动端（<768px）**：简化功能，单栏布局，侧边栏折叠

#### 4.4.2 断点设计
```scss
// 响应式断点
$breakpoint-xs: 480px;   // 超小屏幕
$breakpoint-sm: 768px;   // 小屏幕
$breakpoint-md: 992px;   // 中等屏幕
$breakpoint-lg: 1200px;  // 大屏幕
$breakpoint-xl: 1920px;  // 超大屏幕
```

#### 4.4.3 移动端优化
- 表格在移动端转为卡片形式
- 搜索栏在移动端折叠为抽屉
- 图表自适应屏幕宽度
- 按钮大小增大（最小44x44px，符合手指点击）

---

## 五、项目实施计划

### 5.1 开发排期
#### 第一阶段：需求与设计（2周）
**时间**：第1-2周

- [ ] 需求调研与分析（2天）
  - 调研多多买菜、美团优选的团长管理功能
  - 分析现有系统痛点
  - 确定功能需求清单
  
- [ ] 竞品分析报告（2天）
  - 整理竞品功能对比
  - 提炼可借鉴的设计模式
  - 确定差异化方向
  
- [ ] 技术方案设计（3天）
  - 技术栈选型与论证
  - 系统架构设计
  - 数据库设计（ER图、表结构）
  - API接口设计
  
- [ ] UI/UX设计（3天）
  - 制定设计规范
  - 绘制交互原型（Figma/Axure）
  - 设计关键页面UI稿
  - 评审与优化

#### 第二阶段：前端架构搭建（1周）
**时间**：第3周

- [ ] 项目初始化（1天）
  - 使用Vite创建Vue 3项目
  - 配置ESLint + Prettier
  - 配置环境变量
  
- [ ] 基础架构搭建（2天）
  - 配置Vue Router路由
  - 配置Pinia状态管理
  - 封装Axios请求
  - 配置路由守卫（权限验证）
  
- [ ] 公共组件开发（2天）
  - Layout布局组件（Header、Sidebar、Main）
  - 数据表格组件（带筛选、排序、分页）
  - 图表组件（基于ECharts）
  - 上传组件
  
- [ ] 工具函数封装（1天）
  - 认证工具（token存储）
  - 日期格式化
  - 表单验证
  - Excel导出工具

#### 第三阶段：核心功能开发（4周）
**时间**：第4-7周

**第4周：用户认证与权限管理**
- [ ] 登录页面开发（1天）
- [ ] 用户认证接口对接（1天）
- [ ] 路由权限控制实现（1天）
- [ ] 用户信息管理（2天）

**第5周：订单管理模块**
- [ ] 订单列表页面（2天）
  - 搜索筛选功能
  - 表格展示与排序
  - 分页功能
- [ ] 订单详情页面（1天）
- [ ] 订单汇总功能（1天）
- [ ] 配送清单生成与导出（1天）

**第6周：团长管理模块**
- [ ] 团长列表页面（1天）
- [ ] 团长信息增删改查（2天）
- [ ] 团长业绩统计（1天）
- [ ] 社区管理功能（1天）

**第7周：佣金管理与数据看板**
- [ ] 佣金计算逻辑实现（1天）
- [ ] 提现申请功能（1天）
- [ ] 提现审核功能（1天）
- [ ] 数据看板页面（ECharts图表）（2天）

#### 第四阶段：测试与优化（2周）
**时间**：第8-9周

- [ ] 功能测试（3天）
  - 单元测试（关键业务逻辑）
  - 集成测试（API接口）
  - 端到端测试（关键用户流程）
  
- [ ] 性能优化（2天）
  - 代码分割与懒加载
  - 图片压缩与懒加载
  - 接口请求优化（防抖、节流）
  - 打包体积优化
  
- [ ] 兼容性测试（2天）
  - 多浏览器测试
  - 响应式布局测试
  - 移动端适配测试
  
- [ ] Bug修复（3天）
  - 整理测试问题清单
  - 修复已知Bug
  - 回归测试

#### 第五阶段：文档与答辩准备（2周）
**时间**：第10-11周

- [ ] 技术文档编写（3天）
  - 系统设计文档
  - API接口文档
  - 数据库设计文档
  - 部署文档
  
- [ ] 用户手册编写（2天）
  - 管理员操作手册
  - 团长操作手册
  - 常见问题FAQ
  
- [ ] 答辩PPT制作（3天）
  - 项目背景与意义
  - 技术方案与实现
  - 系统演示
  - 项目总结
  
- [ ] 演示视频录制（1天）
  - 功能演示视频（5-8分钟）
  - 视频剪辑与字幕
  
- [ ] 答辩演练（1天）
  - 熟悉答辩内容
  - 预演答辩流程
  - 准备可能的提问

### 5.2 里程碑节点
| 时间节点 | 里程碑 | 交付物 | 验收标准 |
|---------|--------|--------|---------|
| 第2周末 | 需求设计完成 | 需求文档、UI设计稿、技术方案 | 通过导师评审 |
| 第3周末 | 前端架构完成 | 可运行的基础框架、公共组件 | 项目可启动，路由可访问 |
| 第7周末 | 核心功能完成 | 核心功能演示、前后端联调通过 | 订单、团长、佣金功能可用 |
| 第9周末 | 项目测试完成 | 完整系统、测试报告 | 通过功能测试，无严重Bug |
| 第11周末 | 答辩准备完成 | 毕业论文、答辩PPT、演示视频 | 文档完整，系统可演示 |

### 5.3 风险管理
| 风险项 | 风险等级 | 应对措施 |
|--------|---------|---------|
| 技术难点攻克耗时过长 | 中 | 提前学习关键技术，预留缓冲时间 |
| 需求变更导致延期 | 低 | 需求冻结后不轻易变更 |
| 测试阶段发现严重Bug | 中 | 开发阶段做好单元测试，及时修复 |
| 第三方库不兼容 | 低 | 选择成熟稳定的库，做好技术调研 |

### 5.4 每周工作量估算
- **开发阶段**：每周投入30-40小时
- **测试阶段**：每周投入25-30小时
- **文档阶段**：每周投入20-25小时
- **总计**：约11周，总工时约300-350小时

---

## 六、关键技术实现

### 6.1 团长佣金计算与分销功能实现

#### 6.1.1 实现方案
**业务流程**：
1. 订单创建时，根据订单金额和团长佣金比例自动计算佣金
2. 订单完成后，佣金计入团长账户
3. 团长可查看佣金明细和申请提现
4. 管理员审核提现申请

**核心算法**：
```javascript
// 佣金计算公式
佣金金额 = 订单总金额 × 团长佣金比例

// 示例：
订单金额：100元
团长佣金比例：10%
佣金金额：100 × 0.1 = 10元
```

#### 6.1.2 代码实现示例

**后端：佣金计算Service**
```javascript
// services/commissionService.js
class CommissionService {
  /**
   * 计算订单佣金
   * @param {number} orderId - 订单ID
   * @returns {Promise<object>} 佣金信息
   */
  async calculateCommission(orderId) {
    // 查询订单信息
    const order = await Order.findByPk(orderId, {
      include: [{ model: Leader, attributes: ['id', 'commission_rate'] }]
    });
    
    if (!order) {
      throw new Error('订单不存在');
    }
    
    // 计算佣金
    const commissionAmount = (order.total_amount * order.Leader.commission_rate / 100).toFixed(2);
    
    // 创建佣金记录
    const commission = await Commission.create({
      leader_id: order.leader_id,
      order_id: orderId,
      amount: commissionAmount,
      type: 1, // 1-收入
      status: 0 // 0-待结算
    });
    
    // 更新订单佣金字段
    await order.update({ commission_amount: commissionAmount });
    
    return commission;
  }
  
  /**
   * 订单完成后结算佣金
   * @param {number} orderId - 订单ID
   */
  async settleCommission(orderId) {
    const commission = await Commission.findOne({
      where: { order_id: orderId, type: 1 }
    });
    
    if (!commission) {
      throw new Error('佣金记录不存在');
    }
    
    // 更新佣金状态为已结算
    await commission.update({ status: 1 });
    
    // 增加团长账户余额
    await Leader.increment(
      { balance: commission.amount, total_commission: commission.amount },
      { where: { id: commission.leader_id } }
    );
    
    return commission;
  }
}
```

**前端：佣金看板组件**
```vue
<!-- views/Commission/Dashboard.vue -->
<template>
  <div class="commission-dashboard">
    <!-- 佣金统计卡片 -->
    <el-row :gutter="20">
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-title">今日收益</div>
          <div class="stat-value">¥{{ stats.todayIncome }}</div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-title">本月收益</div>
          <div class="stat-value">¥{{ stats.monthIncome }}</div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-title">累计收益</div>
          <div class="stat-value">¥{{ stats.totalIncome }}</div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-title">可提现余额</div>
          <div class="stat-value balance">¥{{ stats.balance }}</div>
          <el-button type="primary" size="small" @click="handleWithdraw">
            申请提现
          </el-button>
        </el-card>
      </el-col>
    </el-row>
    
    <!-- 收益趋势图 -->
    <el-card class="chart-card" style="margin-top: 20px;">
      <div ref="incomeChart" style="height: 400px;"></div>
    </el-card>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import * as echarts from 'echarts';
import { getCommissionStats } from '@/api/commission';

const stats = ref({
  todayIncome: 0,
  monthIncome: 0,
  totalIncome: 0,
  balance: 0
});

const incomeChart = ref(null);

// 获取佣金统计数据
const fetchStats = async () => {
  const { data } = await getCommissionStats();
  stats.value = data;
};

// 初始化图表
const initChart = () => {
  const chart = echarts.init(incomeChart.value);
  const option = {
    title: { text: '近30天收益趋势' },
    tooltip: { trigger: 'axis' },
    xAxis: {
      type: 'category',
      data: stats.value.chartData?.dates || []
    },
    yAxis: { type: 'value' },
    series: [{
      name: '收益',
      type: 'line',
      data: stats.value.chartData?.incomes || [],
      smooth: true
    }]
  };
  chart.setOption(option);
};

onMounted(() => {
  fetchStats();
  initChart();
});
</script>
```

### 6.2 订单汇总与配送清单生成

#### 6.2.1 实现思路
1. 根据筛选条件（日期、社区、团长）查询订单
2. 按商品维度汇总数量（用于配送清单）
3. 使用xlsx库生成Excel文件
4. 前端触发文件下载

#### 6.2.2 代码实现

**后端：配送清单生成**
```javascript
// services/exportService.js
const XLSX = require('xlsx');

class ExportService {
  /**
   * 生成配送清单
   * @param {object} query - 查询条件
   * @returns {Promise<Buffer>} Excel文件Buffer
   */
  async generateDeliveryList(query) {
    const { date, communityId, leaderId } = query;
    
    // 查询订单明细
    const orderItems = await OrderItem.findAll({
      include: [{
        model: Order,
        where: {
          delivery_date: date,
          ...(communityId && { community_id: communityId }),
          ...(leaderId && { leader_id: leaderId }),
          status: { [Op.in]: [1, 2] } // 已确认或配送中
        },
        include: [
          { model: Leader, attributes: ['id', 'user'], include: [{ model: User, attributes: ['real_name'] }] },
          { model: Community, attributes: ['name'] }
        ]
      }]
    });
    
    // 按商品汇总数量
    const summary = {};
    orderItems.forEach(item => {
      const key = item.product_id;
      if (!summary[key]) {
        summary[key] = {
          productName: item.product_name,
          totalQuantity: 0,
          unit: item.unit || '份',
          orders: []
        };
      }
      summary[key].totalQuantity += item.quantity;
      summary[key].orders.push({
        leaderName: item.Order.Leader.user.real_name,
        communityName: item.Order.Community.name,
        quantity: item.quantity
      });
    });
    
    // 构建Excel数据
    const worksheetData = [
      ['配送清单', '', '', '', '', `日期: ${date}`],
      ['商品名称', '总数量', '单位', '团长', '社区', '数量'],
    ];
    
    Object.values(summary).forEach(item => {
      // 第一行：商品汇总
      worksheetData.push([
        item.productName,
        item.totalQuantity,
        item.unit,
        '',
        '',
        ''
      ]);
      
      // 后续行：按团长明细
      item.orders.forEach(order => {
        worksheetData.push([
          '',
          '',
          '',
          order.leaderName,
          order.communityName,
          order.quantity
        ]);
      });
    });
    
    // 创建工作簿
    const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, '配送清单');
    
    // 生成Buffer
    const buffer = XLSX.write(workbook, { type: 'buffer', bookType: 'xlsx' });
    return buffer;
  }
}
```

**后端：导出接口**
```javascript
// routes/export.js
router.get('/delivery-list', authenticate, async (req, res) => {
  try {
    const { date, communityId, leaderId } = req.query;
    
    const buffer = await exportService.generateDeliveryList({
      date,
      communityId,
      leaderId
    });
    
    // 设置响应头
    res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
    res.setHeader('Content-Disposition', `attachment; filename=delivery-list-${date}.xlsx`);
    
    res.send(buffer);
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
});
```

**前端：导出功能**
```vue
<template>
  <el-button type="primary" @click="exportDeliveryList">
    <el-icon><Download /></el-icon>
    导出配送清单
  </el-button>
</template>

<script setup>
import { ElMessage } from 'element-plus';
import { exportDeliveryList as exportAPI } from '@/api/export';

const exportDeliveryList = async () => {
  try {
    const params = {
      date: '2024-03-01',
      communityId: 1
    };
    
    // 调用导出接口
    const response = await exportAPI(params);
    
    // 创建Blob对象
    const blob = new Blob([response.data], {
      type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
    });
    
    // 创建下载链接
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `配送清单-${params.date}.xlsx`;
    link.click();
    
    // 释放URL对象
    window.URL.revokeObjectURL(url);
    
    ElMessage.success('导出成功');
  } catch (error) {
    ElMessage.error('导出失败');
  }
};
</script>
```

### 6.3 权限控制实现

#### 6.3.1 实现方案
- 后端：基于JWT的身份认证 + 角色权限验证
- 前端：路由守卫 + 动态路由 + 指令级权限控制

#### 6.3.2 代码实现

**后端：JWT认证中间件**
```javascript
// middleware/auth.js
const jwt = require('jsonwebtoken');

const authenticate = (req, res, next) => {
  const token = req.headers.authorization?.replace('Bearer ', '');
  
  if (!token) {
    return res.status(401).json({ message: '未授权' });
  }
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({ message 'Token无效' });
  }
};

// 角色权限验证
const authorize = (...roles) => {
  return (req, res, next) => {
    if (!roles.includes(req.user.role)) {
      return res.status(403).json({ message: '权限不足' });
    }
    next();
  };
};

module.exports = { authenticate, authorize };
```

**前端：路由守卫**
```javascript
// router/permission.js
import router from './index';
import { useUserStore } from '@/store/modules/user';

// 白名单（无需登录）
const whiteList = ['/login', '/404'];

router.beforeEach(async (to, from, next) => {
  const userStore = useUserStore();
  const token = userStore.token;
  
  if (token) {
    if (to.path === '/login') {
      next({ path: '/' });
    } else {
      // 获取用户信息
      if (!userStore.roles || userStore.roles.length === 0) {
        try {
          await userStore.getUserInfo();
          next({ ...to, replace: true });
        } catch (error) {
          await userStore.logout();
          next('/login');
        }
      } else {
        // 权限验证
        if (to.meta.roles && !to.meta.roles.includes(userStore.role)) {
          next('/403'); // 无权限
        } else {
          next();
        }
      }
    }
  } else {
    if (whiteList.includes(to.path)) {
      next();
    } else {
      next('/login');
    }
  }
});
```

### 6.4 数据可视化实现

#### 6.4.1 ECharts图表封装
```vue
<!-- components/Charts/LineChart.vue -->
<template>
  <div ref="chartRef" :style="{ height, width }"></div>
</template>

<script setup>
import { ref, onMounted, watch, onBeforeUnmount } from 'vue';
import * as echarts from 'echarts';

const props = defineProps({
  data: { type: Object, required: true },
  height: { type: String, default: '400px' },
  width: { type: String, default: '100%' }
});

const chartRef = ref(null);
let chartInstance = null;

const initChart = () => {
  chartInstance = echarts.init(chartRef.value);
  updateChart();
};

const updateChart = () => {
  const option = {
    tooltip: { trigger: 'axis' },
    xAxis: {
      type: 'category',
      data: props.data.xData
    },
    yAxis: { type: 'value' },
    series: [{
      data: props.data.yData,
      type: 'line',
      smooth: true
    }]
  };
  chartInstance.setOption(option);
};

watch(() => props.data, () => {
  if (chartInstance) {
    updateChart();
  }
}, { deep: true });

onMounted(() => {
  initChart();
  window.addEventListener('resize', () => chartInstance?.resize());
});

onBeforeUnmount(() => {
  chartInstance?.dispose();
});
</script>
```

### 6.5 技术难点与解决方案

#### 6.5.1 大数据量订单列表性能优化
**问题**：订单数据量大时，列表渲染卡顿

**解决方案**：
1. 后端分页查询，每页50条
2. 前端虚拟滚动（使用`el-table`的虚拟滚动）
3. 搜索防抖（延迟500ms）
4. 使用索引优化数据库查询

#### 6.5.2 Excel导出大文件超时
**问题**：导出超过5000条数据时请求超时

**解决方案**：
1. 后端使用流式写入，边查询边写入
2. 前端显示进度条
3. 考虑使用异步导出（生成后通知下载）

#### 6.5.3 佣金计算精度问题
**问题**：JavaScript浮点数计算精度丢失

**解决方案**：
```javascript
// 使用decimal.js库处理金额计算
const Decimal = require('decimal.js');

const calculateCommission = (amount, rate) => {
  return new Decimal(amount).mul(rate).div(100).toFixed(2);
};
```

---

## 七、测试与质量保证

### 7.1 测试策略
- 单元测试
- 集成测试
- 端到端测试

### 7.2 测试用例
- 功能测试用例
- 边界测试用例
- 异常测试用例

### 7.3 测试报告
- 测试覆盖率
- 发现的问题及修复情况

---

## 八、项目总结

### 8.1 完成情况
- 功能完成度
- 与原计划对比

### 8.2 技术难点与解决方案
- 遇到的主要问题
- 解决思路与方法

### 8.3 项目亮点
- 创新点
- 技术优势
- 用户体验优势

### 8.4 不足与改进方向
- 现有不足
- 未来优化方向

---

## 九、参考文献

1. 阮一峰. ES6 标准入门（第3版）[M]. 北京：电子工业出版社, 2017.

2. Evan You. Vue.js 官方文档 [EB/OL]. https://cn.vuejs.org/, 2024.

3. Node.js Foundation. Node.js 官方文档 [EB/OL]. https://nodejs.org/docs/, 2024.

4. Element Plus Team. Element Plus 组件库文档 [EB/OL]. https://element-plus.org/zh-CN/, 2024.

5. Apache ECharts. ECharts 数据可视化文档 [EB/OL]. https://echarts.apache.org/zh/index.html, 2024.

6. Sequelize Team. Sequelize ORM 文档 [EB/OL]. https://sequelize.org/, 2024.

7. 张三, 李四. 社区团购模式下的供应链优化研究[J]. 电子商务研究, 2023, 15(3): 45-52.

8. 王五. 基于Vue.js的后台管理系统设计与实现[D]. 北京: 北京大学, 2023.

9. MDN Web Docs. JavaScript 参考文档 [EB/OL]. https://developer.mozilla.org/zh-CN/, 2024.

10. GitHub. xlsx - SheetJS Community Edition [EB/OL]. https://github.com/SheetJS/sheetjs, 2024.

11. 赵六. 前后端分离架构下的权限管理系统设计[J]. 计算机应用, 2023, 43(2): 120-125.

12. Express.js Team. Express.js 官方文档 [EB/OL]. https://expressjs.com/, 2024.

13. JWT.io. JSON Web Token 标准文档 [EB/OL]. https://jwt.io/, 2024.

14. MySQL AB. MySQL 8.0 Reference Manual [EB/OL]. https://dev.mysql.com/doc/refman/8.0/en/, 2024.

15. 孙七. 社区团购平台的商业模式与技术实现分析[J]. 信息技术与应用, 2023, 12(4): 78-85.

16. Vite Team. Vite 下一代前端构建工具 [EB/OL]. https://cn.vitejs.dev/, 2024.

17. Pinia Team. Pinia 状态管理库文档 [EB/OL]. https://pinia.vuejs.org/zh/, 2024.

18. 周八. RESTful API 设计最佳实践[J]. 软件工程, 2023, 26(1): 30-36.

19. Axios Team. Axios HTTP 客户端文档 [EB/OL]. https://axios-http.com/zh/, 2024.

20. 吴九. 基于Node.js的电商后台系统设计与实现[D]. 上海: 上海交通大学, 2023.

---

## 十、附录

### 附录A：源代码目录结构

#### 前端项目结构
```
community-group-buying-admin/
├── public/                          # 静态资源目录
│   ├── favicon.ico
│   └── index.html
├── src/
│   ├── api/                         # API接口目录
│   │   ├── index.js                 # axios全局配置
│   │   ├── user.js                  # 用户相关接口
│   │   ├── order.js                 # 订单相关接口
│   │   ├── leader.js                # 团长相关接口
│   │   ├── commission.js            # 佣金相关接口
│   │   ├── community.js             # 社区相关接口
│   │   └── export.js                # 导出相关接口
│   ├── assets/                      # 资源文件
│   │   ├── images/                  # 图片资源
│   │   │   ├── logo.png
│   │   │   └── avatar-default.png
│   │   └── styles/                  # 样式文件
│   │       ├── global.scss          # 全局样式
│   │       ├── variables.scss       # SCSS变量
│   │       └── mixins.scss          # SCSS混入
│   ├── components/                  # 公共组件
│   │   ├── Layout/                  # 布局组件
│   │   │   ├── index.vue            # 主布局
│   │   │   ├── Header.vue           # 头部导航
│   │   │   ├── Sidebar.vue          # 侧边栏
│   │   │   └── Breadcrumb.vue       # 面包屑
│   │   ├── Charts/                  # 图表组件
│   │   │   ├── LineChart.vue        # 折线图
│   │   │   ├── BarChart.vue         # 柱状图
│   │   │   └── PieChart.vue         # 饼图
│   │   ├── Table/                   # 表格组件
│   │   │   ├── DataTable.vue        # 数据表格
│   │   │   └── Pagination.vue       # 分页组件
│   │   └── Upload/                  # 上传组件
│   │       └── ImageUpload.vue      # 图片上传
│   ├── views/                       # 页面组件
│   │   ├── Login/                   # 登录模块
│   │   │   └── index.vue
│   │   ├── Dashboard/               # 数据看板
│   │   │   └── index.vue
│   │   ├── Order/                   # 订单管理
│   │   │   ├── index.vue            # 订单列表
│   │   │   └── Detail.vue           # 订单详情
│   │   ├── Leader/                  # 团长管理
│   │   │   ├── index.vue            # 团长列表
│   │   │   ├── Form.vue             # 团长表单
│   │   │   └── Detail.vue           # 团长详情
│   │   ├── Commission/              # 佣金管理
│   │   │   ├── Dashboard.vue        # 佣金看板
│   │   │   ├── Withdrawal.vue       # 提现申请
│   │   │   └── Record.vue           # 佣金记录
│   │   ├── Community/               # 社区管理
│   │   │   └── index.vue
│   │   └── Profile/                 # 个人中心
│   │       └── index.vue
│   ├── router/                      # 路由配置
│   │   ├── index.js                 # 路由入口
│   │   ├── routes.js                # 路由配置
│   │   └── permission.js            # 权限守卫
│   ├── store/                       # 状态管理 (Pinia)
│   │   ├── index.js                 # Store入口
│   │   └── modules/                 # Store模块
│   │       ├── user.js              # 用户状态
│   │       ├── order.js             # 订单状态
│   │       └── app.js               # 应用状态
│   ├── utils/                       # 工具函数
│   │   ├── auth.js                  # 认证工具
│   │   ├── request.js               # 请求封装
│   │   ├── validate.js              # 表单验证
│   │   ├── export.js                # 导出工具
│   │   ├── format.js                # 格式化工具
│   │   └── permission.js            # 权限判断
│   ├── directives/                  # 自定义指令
│   │   └── permission.js            # 权限指令
│   ├── App.vue                      # 根组件
│   └── main.js                      # 入口文件
├── .env.development                 # 开发环境变量
├── .env.production                  # 生产环境变量
├── .eslintrc.js                     # ESLint配置
├── .prettierrc                      # Prettier配置
├── vite.config.js                   # Vite配置
├── package.json                     # 依赖配置
└── README.md                        # 项目说明

#### 后端项目结构
```
community-group-buying-server/
├── src/
│   ├── config/                      # 配置文件
│   │   ├── database.js              # 数据库配置
│   │   ├── jwt.js                   # JWT配置
│   │   └── app.js                   # 应用配置
│   ├── models/                      # 数据模型
│   │   ├── index.js                 # 模型入口
│   │   ├── User.js                  # 用户模型
│   │   ├── Leader.js                # 团长模型
│   │   ├── Community.js             # 社区模型
│   │   ├── Order.js                 # 订单模型
│   │   ├── OrderItem.js             # 订单明细模型
│   │   ├── Product.js               # 商品模型
│   │   ├── Commission.js            # 佣金模型
│   │   └── Withdrawal.js            # 提现模型
│   ├── controllers/                 # 控制器
│   │   ├── authController.js        # 认证控制器
│   │   ├── userController.js        # 用户控制器
│   │   ├── orderController.js       # 订单控制器
│   │   ├── leaderController.js      # 团长控制器
│   │   ├── commissionController.js  # 佣金控制器
│   │   └── exportController.js      # 导出控制器
│   ├── services/                    # 业务逻辑层
│   │   ├── authService.js           # 认证服务
│   │   ├── orderService.js          # 订单服务
│   │   ├── commissionService.js     # 佣金服务
│   │   ├── leaderService.js         # 团长服务
│   │   └── exportService.js         # 导出服务
│   ├── middleware/                  # 中间件
│   │   ├── auth.js                  # 认证中间件
│   │   ├── errorHandler.js          # 错误处理中间件
│   │   ├── validator.js             # 参数验证中间件
│   │   └── logger.js                # 日志中间件
│   ├── routes/                      # 路由
│   │   ├── index.js                 # 路由入口
│   │   ├── auth.js                  # 认证路由
│   │   ├── user.js                  # 用户路由
│   │   ├── order.js                 # 订单路由
│   │   ├── leader.js                # 团长路由
│   │   ├── commission.js            # 佣金路由
│   │   └── export.js                # 导出路由
│   ├── utils/                       # 工具函数
│   │   ├── jwt.js                   # JWT工具
│   │   ├── encryption.js            # 加密工具
│   │   ├── validator.js             # 验证工具
│   │   └── date.js                  # 日期工具
│   ├── migrations/                  # 数据库迁移
│   │   └── 20240301-create-tables.js
│   ├── seeders/                     # 数据填充
│   │   └── 20240301-demo-data.js
│   └── app.js                       # 应用入口
├── tests/                           # 测试文件
│   ├── unit/                        # 单元测试
│   └── integration/                 # 集成测试
├── logs/                            # 日志目录
├── .env                             # 环境变量
├── .env.example                     # 环境变量示例
├── .eslintrc.js                     # ESLint配置
├── package.json                     # 依赖配置
└── README.md                        # 项目说明
```

### 附录B：数据库表结构

详见 **3.2.3 数据库设计** 章节，包含以下8张核心表：
1. users（用户表）
2. leaders（团长表）
3. communities（社区表）
4. orders（订单表）
5. order_items（订单明细表）
6. products（商品表）
7. commissions（佣金记录表）
8. withdrawals（提现申请表）

### 附录C：API接口文档

#### 基础说明
- **Base URL**: `http://localhost:3000/api`
- **认证方式**: Bearer Token (JWT)
- **请求头**: `Authorization: Bearer {token}`
- **响应格式**: JSON

#### 1. 认证接口

**1.1 用户登录**
```
POST /auth/login
```
请求参数：
```json
{
  "username": "admin",
  "password": "123456"
}
```
响应示例：
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userInfo": {
      "id": 1,
      "username": "admin",
      "realName": "管理员",
      "role": "admin"
    }
  }
}
```

**1.2 获取用户信息**
```
GET /auth/info
```
响应示例：
```json
{
  "code": 200,
  "data": {
    "id": 1,
    "username": "admin",
    "realName": "管理员",
    "role": "admin",
    "permissions": ["order:view", "order:create", "leader:manage"]
  }
}
```

#### 2. 订单接口

**2.1 获取订单列表**
```
GET /orders?page=1&pageSize=20&status=1&leaderId=1
```
响应示例：
```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "orderNo": "ORD202403010001",
        "leaderName": "张三",
        "communityName": "阳光小区",
        "totalAmount": 150.00,
        "commissionAmount": 15.00,
        "status": 1,
        "orderDate": "2024-03-01"
      }
    ],
    "total": 100,
    "page": 1,
    "pageSize": 20
  }
}
```

**2.2 创建订单**
```
POST /orders
```
请求参数：
```json
{
  "leaderId": 1,
  "communityId": 1,
  "userName": "李四",
  "userPhone": "13800138000",
  "items": [
    {
      "productId": 1,
      "quantity": 2,
      "price": 25.00
    }
  ],
  "remark": "尽快配送"
}
```

#### 3. 团长接口

**3.1 获取团长列表**
```
GET /leaders?page=1&pageSize=20
```

**3.2 创建团长**
```
POST /leaders
```
请求参数：
```json
{
  "userId": 10,
  "communityId": 1,
  "commissionRate": 10.0
}
```

#### 4. 佣金接口

**4.1 获取佣金统计**
```
GET /commissions/stats
```
响应示例：
```json
{
  "code": 200,
  "data": {
    "todayIncome": 120.50,
    "monthIncome": 3500.00,
    "totalIncome": 15000.00,
    "balance": 5000.00
  }
}
```

**4.2 申请提现**
```
POST /commissions/withdraw
```
请求参数：
```json
{
  "amount": 1000.00,
  "accountName": "张三",
  "accountNumber": "6222021234567890"
}
```

#### 5. 导出接口

**5.1 导出配送清单**
```
GET /export/delivery-list?date=2024-03-01&communityId=1
```
响应：Excel文件流

**5.2 导出订单数据**
```
GET /export/orders?startDate=2024-03-01&endDate=2024-03-31
```
响应：Excel文件流

### 附录D：用户手册

#### 管理员操作手册

**一、登录系统**
1. 打开浏览器，访问系统地址
2. 输入用户名和密码
3. 点击"登录"按钮

**二、查看数据看板**
- 登录后自动进入数据看板
- 可查看今日订单数、销售额等关键指标
- 查看订单趋势图和团长业绩排行

**三、管理订单**
1. 点击左侧菜单"订单管理"
2. 使用搜索栏筛选订单
3. 点击"详情"查看订单明细
4. 点击"导出配送清单"生成配送单

**四、管理团长**
1. 点击"团长管理"菜单
2. 点击"新增团长"添加团长
3. 填写团长信息并绑定社区
4. 设置佣金比例

**五、审核提现**
1. 点击"佣金管理"菜单
2. 查看待审核提现申请
3. 点击"审核"按钮
4. 选择通过或拒绝

#### 团长操作手册

**一、查看佣金**
1. 登录系统后进入个人中心
2. 查看佣金看板（今日收益、本月收益、可提现余额）
3. 查看收益趋势图

**二、管理订单**
1. 点击"我的订单"
2. 查看订单列表
3. 可按状态筛选订单

**三、申请提现**
1. 在个人中心点击"申请提现"
2. 输入提现金额
3. 填写银行卡信息
4. 提交申请
5. 等待管理员审核

**四、查看提现记录**
1. 点击"提现记录"
2. 查看历史提现申请
3. 查看审核状态

### 附录E：部署文档

#### 环境要求
- **Node.js**: 16.x 或以上
- **MySQL**: 8.0 或以上
- **Nginx**: 1.18 或以上（可选）

#### 后端部署

**1. 安装依赖**
```bash
cd community-group-buying-server
npm install
```

**2. 配置环境变量**
```bash
cp .env.example .env
# 编辑.env文件，配置数据库等信息
```

**3. 创建数据库**
```sql
CREATE DATABASE community_group_buying CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

**4. 运行数据库迁移**
```bash
npx sequelize-cli db:migrate
```

**5. 填充测试数据（可选）**
```bash
npx sequelize-cli db:seed:all
```

**6. 启动服务**
```bash
# 开发环境
npm run dev

# 生产环境
npm run start
```

#### 前端部署

**1. 安装依赖**
```bash
cd community-group-buying-admin
npm install
```

**2. 配置环境变量**
```bash
# .env.production
VITE_API_BASE_URL=http://your-api-domain.com/api
```

**3. 构建生产版本**
```bash
npm run build
```

**4. 部署到服务器**
将`dist`目录下的文件上传到服务器

**5. Nginx配置示例**
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    root /var/www/community-group-buying;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    location /api {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

#### 使用PM2管理进程

**1. 安装PM2**
```bash
npm install -g pm2
```

**2. 启动应用**
```bash
pm2 start src/app.js --name community-group-buying-server
```

**3. 设置开机自启**
```bash
pm2 startup
pm2 save
```

**4. 常用命令**
```bash
pm2 list          # 查看进程列表
pm2 restart all   # 重启所有进程
pm2 logs          # 查看日志
pm2 monit         # 监控面板
```
